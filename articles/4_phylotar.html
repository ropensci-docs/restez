<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="restez">
<title>4. Running phylotaR with restez • restez</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4. Running phylotaR with restez">
<meta property="og:description" content="restez">
<meta property="og:image" content="https://docs.ropensci.org/restez/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">restez</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.1.4.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../articles/restez.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/1_rodents.html">1. Build a database of all rodents</a>
    <a class="dropdown-item" href="../articles/2_search_and_fetch.html">2. How to search for and fetch sequences</a>
    <a class="dropdown-item" href="../articles/3_parsing.html">3. Advanced parsing of a GenBank record</a>
    <a class="dropdown-item" href="../articles/4_phylotar.html">4. Running phylotaR with restez</a>
    <a class="dropdown-item" href="../articles/5_tips_and_tricks.html">5. Tips and Tricks</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/restez/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>4. Running phylotaR with restez</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/restez/blob/HEAD/vignettes/4_phylotar.Rmd" class="external-link"><code>vignettes/4_phylotar.Rmd</code></a></small>
      <div class="d-none name"><code>4_phylotar.Rmd</code></div>
    </div>

    
    
<p>In this tutorial we will showcase how a <code>restez</code> database can be used to speed up a <a href="https://github.com/ropensci/phylotaR" class="external-link">phylotaR</a> run. <code>phylotaR</code> runs an automated pipeline for identifying orthologous gene clusters as the first step in a phylogenetic analysis. A user provides a taxonomic identity and the pipeline downloads all relevant sequences and identifies clusters using a local-alignment search tool. For more information on <code>phylotaR</code> see its <a href="https://doi.org/10.3390/life8020020" class="external-link">published article</a>.</p>
<p>By using <code>restez</code> in conjunction with <code>phylotaR</code>, we will not only being saving time, but also improving the chances of a successful <code>phylotaR</code> run – often NCBI Entrez limits the number of requests or even rejects requests from IP addresses that are making too many. Note, however, that the gains in using <code>restez</code> with <code>phylotaR</code> only make sense if you make use of the <code>restez</code> database multiple times or if you wish to radically increase the maximum number of sequences to download per taxon (by default it is only 3,000). Also, note that using a <code>restez</code> database does not currently eliminate the need for an internet connection. <code>phylotaR</code> still needs to look up taxonomic information and must also identify relevant sequence IDs using Entrez (this may change in the future as <code>restez</code> develops).</p>
<p>We will run a <code>phylotaR</code> run for the rodent subfamily, Dipodinae, the clade that contains jerboas. Because this clade is so small, it should not take too long to run it. We will, however, limit to showcasing only the download stage of the <code>phylotaR</code> pipeline, where <code>restez</code> is required.</p>
<div class="section level2">
<h2 id="install-phylotar">Install phylotaR<a class="anchor" aria-label="anchor" href="#install-phylotar"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Currently only the development version of phylotaR can work with restez</span></span>
<span><span class="co"># It must be installed from GitHub using devtools</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span>repo <span class="op">=</span> <span class="st">'ropensci/phylotaR'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Since we will be running the <code>phylotaR</code> pipeline for Dipodinae, we can use the rodents database we created <a href="https://ropensci.github.io/restez/articles/1_rodents.html" class="external-link">before</a>. We do not need to set-up the <code>phylotaR</code> pipeline any differently with a <code>restez</code> database, except to ensure we have set the <code>restez</code> path to the rodent database.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">phylotaR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Restez (no need to call package)</span></span>
<span><span class="fu">restez</span><span class="fu">::</span><span class="fu"><a href="../reference/restez_path_set.html">restez_path_set</a></span><span class="op">(</span>filepath <span class="op">=</span> <span class="va">rodents_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Vars</span></span>
<span><span class="va">wd</span> <span class="op">&lt;-</span> <span class="st">'dipodinae'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">wd</span><span class="op">)</span></span>
<span><span class="va">txid</span> <span class="op">&lt;-</span> <span class="fl">35737</span>  <span class="co"># Dipodinae</span></span>
<span><span class="va">mxsql</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">ncbi_dr</span> <span class="op">&lt;-</span> <span class="st">'[PATH/TO/BLAST]'</span> <span class="co"># e.g. '/usr/local/ncbi/blast/bin'</span></span>
<span></span>
<span><span class="co"># setup</span></span>
<span><span class="fu"><a href="../reference/setup.html">setup</a></span><span class="op">(</span>wd <span class="op">=</span> <span class="va">wd</span>, txid <span class="op">=</span> <span class="va">txid</span>, ncbi_dr <span class="op">=</span> <span class="va">ncbi_dr</span>, mxsql <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run">Run<a class="anchor" aria-label="anchor" href="#run"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run just the first two stages for this demonstration</span></span>
<span><span class="fu">taxise_run</span><span class="op">(</span><span class="va">wd</span><span class="op">)</span></span>
<span><span class="co">#&gt; ---------------------------------------------------</span></span>
<span><span class="co">#&gt; Starting stage TAXISE: [2023-07-24 07:00:06.361265]</span></span>
<span><span class="co">#&gt; ---------------------------------------------------</span></span>
<span><span class="co">#&gt; Searching taxonomic IDs ...</span></span>
<span><span class="co">#&gt; Downloading taxonomic records ...</span></span>
<span><span class="co">#&gt; . [1-38]</span></span>
<span><span class="co">#&gt; Generating taxonomic dictionary ...</span></span>
<span><span class="co">#&gt; ---------------------------------------------------</span></span>
<span><span class="co">#&gt; Completed stage TAXISE: [2023-07-24 07:00:09.45394]</span></span>
<span><span class="co">#&gt; ---------------------------------------------------</span></span>
<span><span class="fu">download_run</span><span class="op">(</span><span class="va">wd</span><span class="op">)</span></span>
<span><span class="co">#&gt; -----------------------------------------------------</span></span>
<span><span class="co">#&gt; Starting stage DOWNLOAD: [2023-07-24 07:00:09.456996]</span></span>
<span><span class="co">#&gt; -----------------------------------------------------</span></span>
<span><span class="co">#&gt; Identifying suitable clades ...</span></span>
<span><span class="co">#&gt; Identified [1] suitable clades.</span></span>
<span><span class="co">#&gt; Connecting to restez database ...</span></span>
<span><span class="co">#&gt; Downloading hierarchically ...</span></span>
<span><span class="co">#&gt; Working on parent [id 35737]: [1/1] ...</span></span>
<span><span class="co">#&gt; . + whole subtree ...</span></span>
<span><span class="co">#&gt; . . Getting [300 sqs] from restez database...</span></span>
<span><span class="co">#&gt; Successfully retrieved [300 sqs] in total.</span></span>
<span><span class="co">#&gt; ------------------------------------------------------</span></span>
<span><span class="co">#&gt; Completed stage DOWNLOAD: [2023-07-24 07:00:16.345238]</span></span>
<span><span class="co">#&gt; ------------------------------------------------------</span></span></code></pre></div>
<p>Sequences that cannot be found locally will be downloaded via Entrez. Sequences may not be found locally for three sets of reasons, 1. <code>phylotaR</code> may have identified non-GenBank sequences (e.g. RefSeq), 2. the local database may have size limits (ours has a min of 100 and a max 1000), and 3. the local database is out of date, new GenBank releases are only made once a month.</p>
<blockquote>
<p>Note: If the <code>phylotaR</code> messages do not explicit state that they are using a <code>restez</code> database, then, you may not have set the <code>restez</code> path.</p>
</blockquote>
<p>Compared to running without a <code>restez</code> database, phylotaR download can run <a href="https://github.com/ropensci/restez/blob/main/other/phylotar_demo.R" class="external-link"><strong>2x</strong> faster</a>.</p>
</div>
<div class="section level2">
<h2 id="next-up">Next up<a class="anchor" aria-label="anchor" href="#next-up"></a>
</h2>
<p><strong><a href="https://docs.ropensci.org/restez/articles/5_tips_and_tricks.html">Tips and tricks</a></strong></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
